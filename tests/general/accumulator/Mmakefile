#-----------------------------------------------------------------------------#

main_target: check

include ../../Mmake.common
-include ../../Mmake.params

#-----------------------------------------------------------------------------#

ifeq ($(HAVE_NUPROLOG),yes)
%.exp: %.nu
	{ [ -f $*.inp ] && cat $*.inp; } | ./$< > $@ 2>&1;
endif

#-----------------------------------------------------------------------------#

# Any program added here should also be added to the `.cvsignore' file.

PROGS=		base		\
		call_in_base	\
		chain		\
		commutative	\
		construct_test	\
		deconstruct_test\
		dcg		\
		disj		\
		func		\
		highorder	\
		heuristic	\
		identity	\
		inter		\
		ite		\
		nonrec		\
		out_to_in	\
		qsort		\
		simple		\
		split		\
		swap

ACC_FLAGS = -d accum --introduce-accumulators --optimize-constructor-last-call \
		--intermodule-optimization

	# Optimizations to turn off/on.
	# Deforestation optimizes away the opportunities for accumulator
	# introduction in many of the test cases, so turn it off.
OPT_FLAGS = --trace-optimized --excess-assign --common-struct \
		--no-deforestation

	# Ensure that the accumulator introduction flags are passed
	# after EXTRA_MCFLAGS, so that we can override things set in
	# EXTRA_MCFLAGS.
ALL_MCGFLAGS+= $(OPT_FLAGS) $(ACC_FLAGS)

    # programs which aren't working.
NOT_WORKING =

DEPENDS=$(PROGS:%=%.depend)
OUTS=	$(PROGS:%=%.out)
EXPS=	$(PROGS:%=%.exp)
RESS=	$(PROGS:%=%.res)
MODS=	$(PROGS:%=%.mod)

depend: $(DEPENDS)

exp:	$(EXPS)

check:	$(OUTS) $(RESS)

mods:	$(MODS)

all:	$(PROGS)

realclean_local: clean_hlds_dump

clean_hlds_dump:
	-rm -f *hlds_dump*

#-----------------------------------------------------------------------------#
